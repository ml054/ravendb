<div data-bind="if: databases().sortedDatabases().length === 0, visible: databases().sortedDatabases().length === 0" class="content-margin">
    <div class="row">
        <div class="col-sm-8 col-sm-offset-2 col-lg-6 col-lg-offset-3">
            <i class="icon-xl icon-empty-set text-muted"></i>
            <h2 class="text-center">No databases have been created</h2>
            <p class="lead text-center text-muted">Go ahead and<a href="#" data-bind="click: createNewDatabase">&nbsp;create one now</a></p>
        </div>
    </div>
</div>
<div class="databases flex-vertical absolute-fill content-margin" data-bind="if: databases().sortedDatabases().length, visible: databases().sortedDatabases().length, css: { 'databases_compact': compactView() }">
    <div class="flex-header">
    <div class="databasesToolbar">
        <div class="form-inline">            
            <div class="checkbox checkbox-primary checkbox-inline align-checkboxes">
                <input type="checkbox" class="styled" data-bind="checkboxTriple: selectionState, event: { change: toggleSelectAll }">
                <label></label>
            </div>
            <div class="input-group">
                <input type="text" class="form-control" placeholder="Filter" accesskey="/" title="Filter databases (Alt+/)" data-bind="textInput: filters.searchText">    
            </div>
            <div class="databasesToolbar-actions">
                <button class="btn btn-primary" data-bind="click: newDatabase">
                    <i class="icon-plus"></i>
                    <span>New database</span>
                </button>
                
                <div class="btn-group-label" data-bind="css: { active: selectedDatabases().length }" data-label="Selection" role="group">
                    <button class="btn btn-danger" data-bind="visible: isGlobalAdmin(), enable: selectedDatabases().length, click: deleteSelectedDatabases">
                        <i class="icon-trash"></i>
                        <span>Delete</span>
                    </button>
                    
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" title="Change the options of selected databases"
                                data-bind="enable: selectedDatabases().length && !spinners.globalToggleDisable(), css: { 'btn-spinner': spinners.globalToggleDisable() }" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="icon-play"></i><span>Set state...</span>
                            <span class="caret"></span>
                            <span class="sr-only">Toggle Dropdown</span>
                        </button>
                        <ul class="dropdown-menu">
                            <li data-bind="click: enableSelectedDatabases">
                                <a href="#" title="Enable">
                                    <i class="icon-unlock"></i>
                                    <span>Enable</span>
                                </a>
                            </li>
                            <li data-bind="click: disableSelectedDatabases">
                                <a href="#" title="Disable">
                                    <i class="icon-lock"></i>
                                    <span>Disable</span>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="toggle toggle-primary databasesToolbar-toggleCompactView pull-right">
                <input id="compactViewInput" name="compactView" class="styled" type="checkbox" data-bind="checked: $root.compactView" />
                <label for="compactViewInput">
                    Compact View
                </label>
            </div>
    </div> 
    </div>
    </div>

    <div class="flex-grow scroll">
    <div data-bind="foreach: databases().sortedDatabases">
        <div class="panel database-item" data-bind="scrollTo: isCurrentlyActiveDatabase(), visible: !filteredOut(), attr: { class: 'panel database-item ' + badgeClass() + ' ' + (isCurrentlyActiveDatabase() ? 'active' : '') }">
            <div data-bind="attr: { 'data-state-text': badgeText, class: 'state ' + badgeClass() }"></div>
            <div class="padding padding-sm database-info">
                
                    <div class="info-container">
                        <div class="checkbox">
                            <input type="checkbox" class="styled" data-bind="checked: $root.selectedDatabases, checkedValue: name">
                            <label></label>
                        </div>
                        <h3 class="database-name">                            
                            <span title="Database is disabled" data-bind="visible: !canNavigateToDatabase()"><i class="icon-database"></i><span data-bind="text: name"></span></span>
                            <a data-bind="attr: { title: name, href: $root.allDocumentsUrl($data) }, visible: canNavigateToDatabase()" href="#"><i class="icon-database"></i><span data-bind="text: name"></span></a>
                        </h3>
                    </div>
                    <div class="vertical-divider properties-container" 
                         data-bind="template: { name: hasLoadError() ? 'invalid-database-properties-template': 'valid-database-properties-template' }">
                    </div>
                    <div class="actions-container">
                        <span data-bind="visible: isLoading">
                            <span class="global-spinner spinner-sm"></span>&nbsp;&nbsp;&nbsp;&nbsp;
                        </span>

                        <div class="actions">
                            <div class="btn-toolbar pull-right-sm" role="toolbar">                                
                                <div class="btn-group">
                                    <button class="btn btn-default"
                                            data-bind="click: $root.toggleDatabase, 
                                                       css: { 'btn-spinner': inProgressAction }, 
                                                       disable: isBeingDeleted() || inProgressAction()">
                                        <span data-bind="visible: inProgressAction(), text: inProgressAction()"></span>

                                        <i class="icon-unlock" data-bind="visible: !inProgressAction() && disabled()"></i>
                                        <span data-bind="visible: !inProgressAction() && disabled()">Enable</span>

                                        <i class="icon-lock" data-bind="visible: !inProgressAction() && !disabled()"></i>
                                        <span data-bind="visible: !inProgressAction() && !disabled()">Disable</span>
                                    </button>
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"  
                                            data-bind="disable: isBeingDeleted() || inProgressAction()">
                                        <span class="caret"></span>
                                        <span class="sr-only">Toggle Dropdown</span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li data-bind="visible: online() && !indexingPaused() && !indexingDisabled()">
                                            <a href="#" data-bind="click: $root.togglePauseDatabaseIndexing">
                                                <i class="icon-pause"></i> Pause indexing
                                            </a>
                                        </li>
                                        <li data-bind="visible: indexingPaused()">
                                            <a href="#" data-bind="click: $root.togglePauseDatabaseIndexing">
                                                <i class="icon-play"></i> Resume indexing
                                            </a>
                                        </li>
                                        <li data-bind="visible: !indexingDisabled()">
                                            <a href="#" data-bind="click: $root.toggleDisableDatabaseIndexing">
                                                <i class="icon-lock"></i> Disable indexing
                                            </a>
                                        </li>
                                        <li data-bind="visible: indexingDisabled()">
                                            <a href="#" data-bind="click: $root.toggleDisableDatabaseIndexing">
                                                <i class="icon-play"></i> Enable indexing
                                            </a>
                                        </li>
                                        <li>
                                            <!--<a href="#" class="btn-prerelease" data-bind="click: $root.toggleRejectDatabaseClients.bind($root, $data)"> -->
                                            <a href="#" class="btn-prerelease">
                                                <i class="icon-umbrella"></i> Reject clients mode
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <button class="btn btn-success" data-bind="click: $root.activateDatabase">
                                    <i class="icon-refresh"></i>
                                </button>
                                <button class="btn btn-danger" data-bind="click: $root.deleteDatabase, disable: isBeingDeleted"> 
                                    <i class="icon-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
            </div>
        </div>
        </div>
    </div>
</div>

<script type="text/html" id="invalid-database-properties-template">
    <div class="text-danger">
        <i class="icon-exclamation"></i>
        <span data-bind="text: loadError"></span>
    </div>
</script>

<script type="text/html" id="valid-database-properties-template">

    <div class="properties-item" data-bind="visible: totalSize">
        <div class="properties-value value-only">
            <a class="set-size text-disabled" title="Total size. Click to view storage report" data-bind="attr: { href: $root.storageReportUrl($data) }, css: { 'link-disabled': !canNavigateToDatabase() }">
                <i class="icon-drive"></i>
                <span data-bind="text: totalSize"></span>
            </a>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: $data.qualifier === 'db', if: $data.qualifier === 'db'">
        <div class="properties-value value-only">
            <a class="set-size text-disabled" title="Number of documents. Click to view documents list" data-bind="attr: { href: $root.allDocumentsUrl($data) }, css: { 'link-disabled': !canNavigateToDatabase() }">
                <i class="icon-document-group"></i>
                <span data-bind="text: documentsCount().toLocaleString()"></span>
                <span class="hidden-compact" data-bind="text: $root.pluralize(documentsCount().toLocaleString(), 'document', 'documents', true)"></span>
            </a>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: $data.qualifier === 'db', if: $data.qualifier === 'db'">
        <div class="properties-value value-only">
            <a class="set-size text-disabled" title="Number of indexes. Click to view indexes list" data-bind="attr: { href: $root.indexesUrl($data) }, css: { 'link-disabled': !canNavigateToDatabase() }">
                <i class="icon-index"></i>
                <span data-bind="text: indexesCount().toLocaleString()"></span>
                <span class="hidden-compact" data-bind="text: $root.pluralize(indexesCount().toLocaleString(), 'index', 'indexes', true)"></span>
            </a>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: indexingErrors()">
        <div class="properties-value value-only">
            <a class="set-size text-danger" title="Indexing errors. Click to view details" data-bind="attr: { href: $root.indexErrorsUrl($data) }, css: { 'link-disabled': !canNavigateToDatabase() }">             
                <i class="icon-exclamation"></i>
                <span data-bind="text: indexingErrors().toLocaleString()"></span>
                <span class="hidden-compact" data-bind="text: $root.pluralize(indexingErrors().toLocaleString(), 'indexing error', 'indexing errors', true)"></span>                
            </a>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: alerts()">  
        <div class="properties-value value-only">
            <div class="set-size text-warning" title="Alerts" data-bind="css: { 'link-disabled': !canNavigateToDatabase() }">            
                <i class="icon-warning"></i>
                <span data-bind="text: alerts().toLocaleString()"></span>
                <span class="hidden-compact" data-bind="text: $root.pluralize(alerts().toLocaleString(), 'alert', 'alerts', true)"></span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: backupEnabled()">  
        <div data-bind="attr: { class: 'properties-value value-only ' + backupStatus() }">
            <a class="set-size text-disabled" title="Backup. Click to set periodic export" data-bind="attr: { href: $root.periodicExportUrl($data) }, css: { 'link-disabled': !canNavigateToDatabase() }">
                <i class="icon-backup"></i>
                <span data-bind="text: backupStatus() !== 'text-danger' ? 'Backed up ' + lastFullOrIncrementalBackup() : 'Never backed up'"></span>
            </a>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: uptime()">
        <div class="properties-value value-only ">
            <div class="set-size" title="Uptime">
                <i class="icon-recent"></i>
                <span>
                    <span class="hidden-compact">Up for</span>
                    <span data-bind="text: uptime()"></span>
                </span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: indexingPaused() && !indexingDisabled()"> 
        <div class="properties-value value-only">
            <a class="set-size text-warning" title="Indexing is paused. Click to view indexes list" data-bind="attr: { href: $root.indexesUrl($data) }">
                <i class="icon-pause"></i>
                <span>Indexing paused</span>
            </a>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: indexingDisabled()">
        <div class="properties-value value-only">
            <div class="set-size text-danger" title="Indexing disabled">
                <i class="icon-lock"></i>
                <span class="hidden-compact">Indexing disabled</span>
            </div>
        </div>
    </div>

    <div class="properties-item" data-bind="visible: rejectClients()">
        <div class="properties-value value-only">
            <div class="set-size text-warning" title="Clients rejection mode">
                <i class="icon-umbrella"></i>
                <span>Clients rejection mode</span>
            </div>
        </div>
    </div>
    
</script>